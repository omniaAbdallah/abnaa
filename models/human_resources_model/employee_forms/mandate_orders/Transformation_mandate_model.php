<?phpclass Transformation_mandate_model extends CI_Model{    public function __construct()    {        parent:: __construct();  //Public_employee_main_data->get_qsm_name_by_emp_id        $this->load->model('human_resources_model/Public_employee_main_data');    }    public function my_orders($table, $arr)    {        $this->db->where($arr);        $query = $this->db->get($table);        if ($query->num_rows() > 0) {            $query = $query->result();            $i=1;            foreach ($query as $row) {                $data[$i] = $row;                $data[$i]->name = $this->get_name($row->emp_id_fk);                $i++;            }            return $data;        } else {            return false;        }    }    public function get_name($emp)    {        $this->db->where('id',$emp);        $query=$this->db->get('employees');        if($query->num_rows()>0)        {            return $query->row()->employee;        }else{            return 0;        }    }    public function my_orders_history($table, $arr)    {        $this->db->where($arr);        $query = $this->db->get($table);        if ($query->num_rows() > 0) {            $query = $query->result();            foreach ($query as $key => $value) {                $query[$key]->personal_emp_img = $this->get_personal_img_emp($value->from_user_id);            }            return $query;        } else {            return false;        }    }    public function change_approved($id)    {        $q = $this->get_by_id('hr_entdab', $id);        $sett = $this->get_from_setting(1);        $data['level'] = 1;        $data['current_from_user_id'] = $q->current_to_user_id;        $data['current_from_user_name'] = $this->get_user_name_submit($data['current_from_user_id']);        $data['current_to_user_id'] = $this->get_user_emp_id($q->direct_manager_id_fk, 3);        $data['current_to_user_name'] = $this->get_user_name_submit($data['current_to_user_id']);        $data['talab_in_fk'] = $sett->id;        $data['talab_in_title'] = $sett->title;        $data['talab_msg'] = $sett->msg_accept;        $data['suspend'] = 1;        $this->db->where('id', $id);        $this->db->update('hr_entdab', $data);    }    public function get_all_employees($table)    {        return $this->db->get($table)->result();    }    public function get_by_id($table, $id)    {        $this->db->where('id', $id);        $query = $this->db->get($table);        $data = array();        if ($query->num_rows() > 0) {          return $query->row();        } else {            return false;        }    }    public function get_emp($id)    {        $this->db->where('id', $id);        $query = $this->db->get('employees');        if ($query->num_rows() > 0) {            return $query->row()->employee;        } else {            return false;        }    }    /*11-11-20-om*/    public function change_suspend()    {        $sett = $this->get_from_setting($this->input->post('level'));        $sett_msg = $this->get_from_setting($this->input->post('level')-1);        $id = $this->input->post('mandate_rkm_id');        $q = $this->get_by_id('hr_entdab', $id);        $data['current_from_user_id'] = $this->input->post('current_from_id');        $data['current_to_user_id'] = $this->get_user_emp_id($this->input->post('current_to_id'), 3);        $data['current_from_user_name'] = $this->get_user_name_submit($data['current_from_user_id']);        $data['current_to_user_name'] = $this->get_user_name_submit($data['current_to_user_id']);        $data['suspend'] = $this->input->post('valu');        $data['level'] = $this->input->post('level');        $data['talab_in_fk'] = $sett->id;        $data['talab_in_title'] = $sett->title;        if ($this->input->post('valu') == 1) {            $data['talab_msg'] = $sett_msg->msg_accept;        } else {            $data['talab_msg'] = $sett_msg->msg_refuse;            $data['reason_action'] = $this->input->post('reason_action');        }        switch ($data['level']) {            case 2:                $data['action_emp'] = $this->input->post('valu');                break;            case 3:                $data['action_moder_final'] = $this->input->post('valu');                break;            default:                break;        }        if ($data['suspend'] == 2) {            if ($this->input->post('level') > 2) {                $data['suspend'] = 5;//                $data['current_to_id'] = $q->emp_user_id;                $data['current_to_user_id'] = $q->current_from_user_id;                $data['current_to_user_name'] = $this->get_user_name_submit($data['current_to_user_id']);            } else {                $data['level'] = 0;                $data['current_to_user_id'] = $q->current_from_user_id;                $data['current_to_user_name'] = $this->get_user_name_submit($data['current_to_user_id']);            }        }        if ($this->input->post('level') == 3 && $data['suspend'] == 1) {            $data['suspend'] = 4;            $data['level'] = 0;            $data['current_to_user_id'] = $q->emp_user_id;            $data['current_to_user_name'] = $this->get_user_name_submit($data['current_to_user_id']);        }        $data['seen'] = 0;        $this->db->where('id', $id);        $this->db->update('hr_entdab', $data);    }    //===================================================    public function get_from_setting($level)    {        $this->db->where('level', $level);        $this->db->where('tbl', 'mandate');        $query = $this->db->get('hr_all_transformation_setting');        if ($query->num_rows() > 0) {            return $query->row();        } else {            return false;        }    }    //===================================================    /*11-11-20-om*/    public function insert_transformation()    {        $id = $this->input->post('mandate_rkm_id');        $q = $this->get_by_id('hr_entdab', $id);        $data['mandate_rkm_fk'] = $q->rkm_talab;        $data['mandate_rkm_id'] = $q->id;        $data['from_user_id'] = $q->current_from_user_id;        $data['to_user_id'] = $q->current_to_user_id;        $data['from_user_name'] = $q->current_from_user_name;        $data['to_user_name'] = $q->current_to_user_name;       /* $data['from_user_name'] = $this->get_user_name_submit($data['from_user_id']);        $data['to_user_name'] = $this->get_user_name_submit($data['to_user_id']);*/       /* $data['talab_in_fk'] = $q->talab_in_fk;        $data['talab_in_title'] = $q->talab_in_title;        $data['talab_msg'] = $q->talab_msg;*/        $data['level'] = $this->input->post('level')-1;        $sett = $this->get_from_setting($data['level']);        $data['talab_in_fk'] = $sett->id;        $data['talab_in_title'] = $sett->title;        $data['talab_msg'] = $sett->msg_accept;        $data['reason_action'] = $this->input->post('reason_action');        //====================================================        $data['suspend'] = $this->input->post('valu');        $data['date'] = strtotime(date("Y-m-d"));        $data['date_ar'] = date("Y-m-d");        $data['publisher'] = $_SESSION['user_id'];        //print_r($data);        $data['seen'] = 0;        $this->db->insert('hr_entdab_history', $data);    }    public function select_by()    {        $this->db->select('*');        $this->db->from('department_jobs');        $this->db->where('id !=', 9);        $this->db->where('from_id_fk', 0);        $query = $this->db->get();        if ($query->num_rows() > 0) {            foreach ($query->result() as $row) {                $data[] = $row;            }            return $data;        }        return false;    }    public function get_emps_by_edara($table, $valu)    {        $this->db->where('administration', $valu);        return $this->db->get($table)->result();    }    //====================    public function get_user_name_submit($user_id)    {        $this->db->select('*');        $this->db->where("user_id", $user_id);        $query = $this->db->get('users');        if ($query->num_rows() > 0) {            $data = $query->row();            if ($data->role_id_fk == 1 or $data->role_id_fk == 5) {                return $data->user_username;            } elseif ($data->role_id_fk == 2) {                $name = $this->get_user_name_member($data->user_name);                return $name;            } elseif ($data->role_id_fk == 3) {                $name = $this->get_emp_name($data->emp_code);                return $name;            } elseif ($data->role_id_fk == 4) {                $name = $this->name_general_assembley($data->user_name);                return $name;            }        }        return false;    }    public function get_user_name_member($user_id)    {        $this->db->select('*');        $this->db->where("id", $user_id);        $query = $this->db->get('magls_members_table');        if ($query->num_rows() > 0) {            $data = $query->row();            return $data->member_name;        }        return false;    }    public function get_emp_name($user_id)    {        $this->db->select('*');        $this->db->where("id", $user_id);        $query = $this->db->get('employees');        if ($query->num_rows() > 0) {            $data = $query->row();            return $data->employee;        }        return false;    }    public function name_general_assembley($user_id)    {        $this->db->select('*');        $this->db->where("id", $user_id);        $query = $this->db->get('general_assembley_members');        if ($query->num_rows() > 0) {            $data = $query->row();            return $data->name;        }        return false;    }    public function get_user_emp_id($user_id, $role_id_fk)    {        $this->db->where('emp_code', $user_id);        $this->db->where('role_id_fk', $role_id_fk);        $query = $this->db->get('users');        if ($query->num_rows() > 0) {            return $query->row()->user_id;        } else {            return false;        }    }    /*11-11-20-om*/    public function get_moder_final_data($emp_id)    {        $data = array();        $this->db->select('*');        $this->db->from('employees');        $this->db->where('id', $emp_id);        $query = $this->db->get();        if ($query->num_rows() > 0) {            $x = 0;            $data[$x] = $query->row();            $data[$x]->person_img = $data[$x]->personal_photo;            $data[$x]->job_name = $data[$x]->mosma_wazefy_n;            return $data[$x];        } else {            return false;        }    }    /*11-11-20-om*/    public function get_emp_data($emp_id)    {        $this->db->where('user_id', $emp_id);        $query1 = $this->db->get('users')->row();        if (!empty($query1)) {            $data = array();            $this->db->select('*');            $this->db->from('employees');            $this->db->where('id', $query1->emp_code);            $query = $this->db->get();            if ($query->num_rows() > 0) {                $x = 0;                $data[$x] = $query->row();                $data[$x]->person_img = $data[$x]->personal_photo;                $data[$x]->job_name = $data[$x]->mosma_wazefy_n;                return $data[$x];            } else {                return false;            }        }    }    public function get_array_by_id($table, $id)    {        $this->db->select('*');        $this->db->from($table);        $this->db->where('mandate_rkm_id', $id);        $query = $this->db->get();        $data = array();        $x = 0;        if ($query->result() > 0) {            //return $query->result();            foreach ($query->result() as $row) {                $data[$x] = $row;                $data[$x]->personal_img = $this->get_personal_img($row->to_user_id);                $data[$x]->personal_emp_img = $this->get_personal_img_emp($row->from_user_id);                $x++;            }            return $data;        } else {            return false;        }    }    public function get_personal_img($id)    {        $this->db->where('user_id', $id);        $query = $this->db->get('users');        if ($query->num_rows() > 0) {            return $query->row()->user_photo;        } else {            return false;        }    }    public function get_personal_img_emp($id)    {        $this->db->where('user_id', $id);        $query1 = $this->db->get('users')->row();        if (!empty($query1)) {            $this->db->where('id', $query1->emp_code);            $query = $this->db->get('employees');            if ($query->num_rows() > 0) {                return $query->row()->personal_photo;            } else {                return false;            }        }    }    //yaraaaaaaaaaaaaaaaaaaaaaaaaaaaaaa//    public function get_employees_by_level($arr)    {        $query = $this->db->where($arr)->get('hr_egraat_emp_setting');        if ($query->num_rows() > 0) {            $query = $query->result();            foreach ($query as $key => $value) {                $query[$key]->photo = $this->Get_photo_by_emp_id($value->person_id);            }            return $query;// Get_photo        } else {            return false;        }    }    public function Get_photo_by_emp_id($emp_id)    {        $this->db->select('employees.id,employees.personal_photo');        $this->db->from("employees");        $this->db->where('id', $emp_id);        $query = $this->db->get();        if ($query->num_rows() > 0) {            return $query->row()->personal_photo;        } else {            return false;        }    }}