<?php/** * Created by PhpStorm. * User: alatheer * Date: 3/9/2020 * Time: 10:32 AM */class Main_setting_m extends CI_Model{    public function all_settings()    {        $this->db->select('*');        $this->db->from('tat_settings');        $this->db->where("from_code", 0);        $query = $this->db->get();        if ($query->num_rows() > 0) {            foreach ($query->result() as $row) {                $data[$row->code] = $row->title;//["title"]                //$data[$row->code]["code"]= $row->code;                //$data[$row->id]['color'] =  $row->color;            }            return $data;        }        return false;    }    public function get_all_data_settings($arr_all)    {        foreach ($arr_all as $key => $value) {            $data[$key] = $this->get_type_settings($key);        }        return $data;    }    public function get_type_settings($from_code)    {        $this->db->select('*');        $this->db->from('tat_settings');        $this->db->where("from_code", $from_code);        $this->db->order_by("id", "asc");        $query = $this->db->get();        if ($query->num_rows() > 0) {            return $query->result();        }        return false;    }   /* public function add($from_code)    {        $last_code = $this->get_max($from_code);        if ($last_code == 0) {            $last_code = $from_code . '01';        } else { // if ($last_code >= ($from_code.'99'))            $next_code = explode($from_code, $last_code);            $pad_length = 2;            if ($next_code > 99) {                $pad_length = 3;            }            $last_code = $from_code . str_pad(($next_code[1] + 1), $pad_length, '0', STR_PAD_LEFT);        }        $data['code'] = $last_code;        $data['title'] = $this->input->post('title');        $data['color'] = $this->input->post('color');        $data['from_code'] = $from_code;        $this->db->insert('tat_settings', $data);    }*/    public function add($from_code)    {        $data['title'] = $this->input->post('title');        if ($this->input->post('color')) {            $data['color'] = $this->input->post('color');        }        $data['from_code'] = $from_code;        $code = $this->get_max($from_code);        $n = $this->add_leading_zero(1);        if (!empty($code)) {            $data['code'] = $code + 1;        } else {            $data['code'] = $from_code . $n;        }        $this->db->insert('tat_settings',$data);    }    function add_leading_zero($value, $threshold = 3)    {        return sprintf('%0' . $threshold . 's', $value);    }    public function update($id)    {        $data['title'] = $this->input->post('title');        $data['color'] = $this->input->post('color');        $this->db->where('id', $id);        $this->db->update('tat_settings', $data);    }    function get_max($from)    {        return $this->db->select_max('code')->where('from_code', $from)->get('tat_settings')->row()->code;    }    function delete($id)    {        $this->db->where('id', $id)->delete('tat_settings');    }    public function getById($id)    {        return $this->db->get_where('tat_settings', array('id' => $id))->row_array();    }                    public function getUserName($user_id)    {        $sql = $this->db->where("user_id", $user_id)->get('users');        if ($sql->num_rows() > 0) {            $data = $sql->row();            if ($data->role_id_fk == 1 or $data->role_id_fk == 5) {                return $data->user_username;            } elseif ($data->role_id_fk == 2) {                $id = $data->user_name;                $table = 'magls_members_table';                $field = 'member_name';            } elseif ($data->role_id_fk == 3) {                $id = $data->emp_code;                $table = 'employees';                $field = 'employee';            } elseif ($data->role_id_fk == 4) {                $id = $data->user_name;                $table = 'general_assembley_members';                $field = 'name';            }            return $this->getUserNameByRoll($id, $table, $field);        }        return false;    }    public function add_band()    {        $data['title'] = $this->input->post('title');        $data['status']=0;        $data['date'] = strtotime(date("Y-m-d"));        if (isset($_SESSION['user_id'])) {            $data['publisher'] = $_SESSION['user_id'];            $data['publisher_n'] = $this->getUserName($_SESSION['user_id']);        }        $this->db->insert('tat_band_moqabla',$data);    }        public function update_band($id)    {        $data['title'] = $this->input->post('title');        $this->db->where('id',$id)->update('tat_band_moqabla',$data);    }      public function get_type_band_settings()    {        $this->db->select('*');        $this->db->from('tat_band_moqabla');        $this->db->order_by("id", "asc");        $query = $this->db->get();        if ($query->num_rows() > 0) {            return $query->result();        }        return false;    }    public function getById_band($id)    {        return $this->db->get_where('tat_band_moqabla', array('id' => $id))->row_array();    }    function delete_band($id)    {        $this->db->where('id', $id)->delete('tat_band_moqabla');    }    public function change_status($valu, $id)	{			$status = 1 - $valu;			$data['status'] = $status;			$this->db->where('id', $id)->update('tat_band_moqabla', $data);			return $status;	}                public function add_band_taqeem()    {        $data['title'] = $this->input->post('title');        $data['max_degree'] = $this->input->post('max_degree');        $data['in_order'] = $this->input->post('in_order');        $data['status']=0;        $data['date'] = strtotime(date("Y-m-d"));        if (isset($_SESSION['user_id'])) {            $data['publisher'] = $_SESSION['user_id'];            $data['publisher_n'] = $this->getUserName($_SESSION['user_id']);        }        $this->db->insert('tat_band_taqeem',$data);    }    public function update_band_taqeem($id)    {        $data['title'] = $this->input->post('title');        $data['max_degree'] = $this->input->post('max_degree');        $data['in_order'] = $this->input->post('in_order');        $this->db->where('id',$id)->update('tat_band_taqeem',$data);    }    public function get_type_band_taqeem_settings()    {        $this->db->select('*');        $this->db->from('tat_band_taqeem');        $this->db->order_by("id", "asc");        $query = $this->db->get();        if ($query->num_rows() > 0) {            return $query->result();        }        return false;    }    public function getById_band_taqeem($id)    {        return $this->db->get_where('tat_band_taqeem', array('id' => $id))->row_array();    }    function delete_band_taqeem($id)    {        $this->db->where('id', $id)->delete('tat_band_taqeem');    }    public function change_status_band_taqeem($valu, $id)    {        $status = 1 - $valu;        $data['status'] = $status;        $this->db->where('id', $id)->update('tat_band_taqeem', $data);        return $status;    }/*************************************************/    public function add_emp_magalat() {    $data['edara_id']= $this->input->post('edara_id');    $data['emp_magal_name']=$this->input->post('emp_magal_name');    $this->db->insert('tat_emp_mgalat_setting',$data);    }          public function update_emp_magalat($id){     $data['edara_id']= $this->input->post('edara_id');    $data['emp_magal_name']=$this->input->post('emp_magal_name');      $this->db->where('id',$id);      $this->db->update('tat_emp_mgalat_setting',$data);  }              public function get_all_emp_magalat_records()    {        $this->db->select('tat_emp_mgalat_setting.*,hr_edarat_aqsam.title as edara_name');        $this->db->from('tat_emp_mgalat_setting');        $this->db->join('hr_edarat_aqsam','hr_edarat_aqsam.id = tat_emp_mgalat_setting.id');        $this->db->order_by("id", "asc");        $query = $this->db->get();        if ($query->num_rows() > 0) {            return $query->result();        }        return false;    }          /*  public function getById_emp_magalat($id)    {        return $this->db->get_where('tat_emp_mgalat_setting', array('id' => $id))->row_array();    }    */            public function getById_emp_magalat($id){        $this->db->select('*');        $this->db->from('tat_emp_mgalat_setting');        $this->db->where('id',$id);        $query = $this->db->get();        if ($query->num_rows() > 0) {            foreach ($query->result() as $row) {                $data = $row;               }            return $data;        }else{           return 0;        }    }          public function delete_emp_magalat($id)    {        $this->db->where('id',$id);        $this->db->delete("tat_emp_mgalat_setting");    }    }