<?phpclass Message_gam3ia_model extends CI_Model{ function get_message_by($where_arr = false)    {        if (!empty($where_arr)) {            $this->db->where($where_arr);        }        $q = $this->db->order_by('id', 'desc')->limit(15)->get('md_gam3ia_contact')->result();        /* echo "last sql :";         print_r($this->db->last_query());*/        if (!empty($q)) {            foreach ($q as $key => $row) {                if ($row->member_type_to == 1) {                    $from_date = $this->get_by('md_all_gam3ia_omomia_members', array('id' => $row->send_from_id_fk), 1);                    if (!empty($from_date)) {                        $q[$key]->from_name = $from_date->name;                        if (!empty($from_date->mem_img)) {                            $q[$key]->from_img = 'uploads/md/gam3ia_omomia_members/' . $from_date->mem_img;                        } else {                            $q[$key]->from_img = 'asisst/admin_asset/img/avatar5.png';                        }                    } else {                        $q[$key]->from_name = 'غير محدد';                        $q[$key]->from_img = 'asisst/admin_asset/img/avatar5.png';                    }                } elseif ($row->member_type_to == 2) {                    $from_date = $this->get_by('employees', array('id' => $row->send_from_id_fk), 1);                    if (!empty($from_date)) {                        $q[$key]->from_name = $from_date->employee;                        if (!empty($from_date->personal_photo)) {                            $q[$key]->from_img = 'uploads/human_resources/emp_photo/thumbs/' . $from_date->personal_photo;                        } else {                            $q[$key]->from_img = 'asisst/admin_asset/img/avatar5.png';                        }                    } else {                        $q[$key]->from_name = 'غير محدد';                        $q[$key]->from_img = 'asisst/admin_asset/img/avatar5.png';                    }                }                $to_date = $this->get_by('md_all_gam3ia_omomia_members', array('id' => $row->send_to_id_fk), 1);                if (!empty($to_date)) {                    $q[$key]->to_name = $to_date->name;                    if (!empty($to_date->mem_img)) {                        $q[$key]->to_img = 'uploads/md/gam3ia_omomia_members/' . $to_date->mem_img;                    } else {                        $q[$key]->to_img = 'asisst/admin_asset/img/avatar5.png';                    }                } else {                    $q[$key]->from_name = 'غير محدد';                    $q[$key]->from_img = 'asisst/admin_asset/img/avatar5.png';                }            }        }        return $q;    }    function get_message_2_by($where_arr = false, $page)    {        if (!empty($where_arr)) {            $this->db->where($where_arr);        }       /* $this->db->where('replay_id_fk',0);*/        switch ($page) {            case 4:                $this->db->group_start()->where('send_to_id_fk', $_SESSION['id'])->where('stared_to', 1)->group_end();                $this->db->or_group_start()->where('send_from_id_fk', $_SESSION['id'])->where('started_from', 1)->group_end();                break;            case 3:                $this->db->group_start()->where('send_to_id_fk', $_SESSION['id'])->group_start()->where('deleted_to', 1)->or_where('archived_to', 1)->group_end()->group_end();                $this->db->or_group_start()->where('send_from_id_fk', $_SESSION['id'])->group_start()->where('deleted_from', 1)->or_where('archived_from', 1)->group_end()->group_end();                break;        }        $q = $this->db->order_by('id', 'desc')->limit(15)->get('md_gam3ia_contact')->result();        /*echo "last sql :";        print_r($this->db->last_query());*/        if (!empty($q)) {            foreach ($q as $key => $row) {                if ($row->member_type_to == 1) {                    $from_date = $this->get_by('md_all_gam3ia_omomia_members', array('id' => $row->send_from_id_fk), 1);                    if (!empty($from_date)) {                        $q[$key]->from_name = $from_date->name;                        if (!empty($from_date->mem_img)) {                            $q[$key]->from_img = 'uploads/md/gam3ia_omomia_members/' . $from_date->mem_img;                        } else {                            $q[$key]->from_img = 'asisst/admin_asset/img/avatar5.png';                        }                    } else {                        $q[$key]->from_name = 'غير محدد';                        $q[$key]->from_img = 'asisst/admin_asset/img/avatar5.png';                    }                } elseif ($row->member_type_to == 2) {                    $from_date = $this->get_by('employees', array('id' => $row->send_from_id_fk), 1);                    if (!empty($from_date)) {                        $q[$key]->from_name = $from_date->employee;                        if (!empty($from_date->personal_photo)) {                            $q[$key]->from_img = 'uploads/human_resources/emp_photo/thumbs/' . $from_date->personal_photo;                        } else {                            $q[$key]->from_img = 'asisst/admin_asset/img/avatar5.png';                        }                    } else {                        $q[$key]->from_name = 'غير محدد';                        $q[$key]->from_img = 'asisst/admin_asset/img/avatar5.png';                    }                }                $to_date = $this->get_by('md_all_gam3ia_omomia_members', array('id' => $row->send_to_id_fk), 1);                if (!empty($to_date)) {                    $q[$key]->to_name = $to_date->name;                    if (!empty($to_date->mem_img)) {                        $q[$key]->to_img = 'uploads/md/gam3ia_omomia_members/' . $to_date->mem_img;                    } else {                        $q[$key]->to_img = 'asisst/admin_asset/img/avatar5.png';                    }                } else {                    $q[$key]->from_name = 'غير محدد';                    $q[$key]->from_img = 'asisst/admin_asset/img/avatar5.png';                }            }        }        return $q;    }/*new*/    function count_2_by( $page)    {        /*        $this->db->where('replay_id_fk',0);*/        switch ($page) {            case 4:                $this->db->group_start()->where('send_to_id_fk', $_SESSION['id'])->where('stared_to', 1)->group_end();                $this->db->or_group_start()->where('send_from_id_fk', $_SESSION['id'])->where('started_from', 1)->group_end();                break;            case 3:                $this->db->group_start()->where('send_to_id_fk', $_SESSION['id'])->group_start()->where('deleted_to', 1)->or_where('archived_to', 1)->group_end()->group_end();                $this->db->or_group_start()->where('send_from_id_fk', $_SESSION['id'])->group_start()->where('deleted_from', 1)->or_where('archived_from', 1)->group_end()->group_end();                break;        }        return $this->db->select('COUNT(id) as count')->get('md_gam3ia_contact')->row_array()['count'];    }}